<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Track Service - ElectroFix</title>
    <link rel="stylesheet" href="../options-css/tracking.css" />

  </head>
  <body>
    <section class="tracking-section">
      <h2>ğŸšš Track Your Service</h2>

      <div class="progress-container">
        <div class="progress-line" id="progress-line"></div>

        <div class="step" id="step1">
          <div class="icon">ğŸ“©</div>
          <p>Request Received</p>
        </div>
        <div class="step" id="step2">
          <div class="icon">ğŸ› ï¸</div>
          <p>Assigned to Repairer</p>
        </div>
        <div class="step" id="step3">
          <div class="icon">ğŸšš</div>
          <p>On the Way</p>
        </div>
        <div class="step" id="step4">
          <div class="icon">âœ…</div>
          <p>Service Completed</p>
        </div>
      </div>
    </section>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        onValue,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCQneRn2fhr2MBPZ8FpGYQTHnSVXe-Y8oQ",
        authDomain: "electrofix-website.firebaseapp.com",
        projectId: "electrofix-website",
        storageBucket: "electrofix-website.appspot.com",
        messagingSenderId: "891241046906",
        appId: "1:891241046906:web:382d83e91f521a357cacc3",
        databaseURL: "https://electrofix-website-default-rtdb.asia-southeast1.firebasedatabase.app/",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const auth = getAuth(app);

      const steps = document.querySelectorAll(".step");
      const progressLine = document.getElementById("progress-line");

      // URL à¦¥à§‡à¦•à§‡ bookingId à¦¬à§‡à¦° à¦•à¦°à¦¾
      const urlParams = new URLSearchParams(window.location.search);
      const bookingId = urlParams.get("bookingId");

      onAuthStateChanged(auth, (user) => {
        if (user && bookingId) {
          const bookingRef = ref(db, `bookings/${user.uid}/${bookingId}`);

          onValue(bookingRef, (snapshot) => {
            if (snapshot.exists()) {
              const booking = snapshot.val();
              const status = booking.status;

              let currentStep = 0;
              if (status === "Request Received") currentStep = 1;
              else if (status === "Assigned to Repairer") currentStep = 2;
              else if (status === "On the Way") currentStep = 3;
              else if (status === "Service Completed") currentStep = 4;

              // Step update à¦•à¦°à¦¾
              steps.forEach((step, index) => {
                if (index < currentStep) {
                  step.classList.add("completed");
                } else {
                  step.classList.remove("completed");
                }
              });

              // Progress line update
              let progressPercent = ((currentStep - 1) / (steps.length - 1)) * 100;
              progressLine.style.width = progressPercent + "%";
            }
          });
        }
      });
    </script>
  </body>
</html>
